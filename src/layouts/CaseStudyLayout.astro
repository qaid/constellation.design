---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Button from '../components/Button.astro';

interface Props {
  title: string;
  description: string;
  category: string;
  client?: string;
  role?: string;
  year?: string;
  industry?: string;
  image?: string;
  prevProject?: { slug: string; title: string };
  nextProject?: { slug: string; title: string };
}

const { 
  title, 
  description, 
  category,
  client,
  role,
  year,
  industry,
  image,
  prevProject,
  nextProject
} = Astro.props;
---

<BaseLayout title={title} description={description} image={image}>
  <Header />
  <main>
    <!-- Hero -->
    <section class="case-hero">
      <div class="container">
        <div class="case-hero__layout">
          <div class="case-hero__media" data-animate>
            {image ? (
              <img class="case-hero__img" src={image} alt={title} loading="eager" decoding="async" />
            ) : (
              <div class="case-hero__image-placeholder" aria-hidden="true"></div>
            )}
          </div>
          <div class="case-hero__card" data-animate>
            <span class="case-hero__category">{role ?? category}</span>
            <h1 class="case-hero__title">{title}</h1>
            <p class="case-hero__description">{description}</p>
          </div>
        </div>
      </div>
    </section>

    <section class="case-snapshot">
      <div class="container">
        <div class="case-snapshot__card" data-animate>
          <div class="case-snapshot__header">Project Snapshot</div>
          {client && (
            <div class="case-snapshot__item">
              <span class="case-snapshot__label">Client</span>
              <span class="case-snapshot__value">{client}</span>
            </div>
          )}
          {role && (
            <div class="case-snapshot__item">
              <span class="case-snapshot__label">Role</span>
              <span class="case-snapshot__value">{role}</span>
            </div>
          )}
          {year && (
            <div class="case-snapshot__item">
              <span class="case-snapshot__label">Year</span>
              <span class="case-snapshot__value">{year}</span>
            </div>
          )}
          {industry && (
            <div class="case-snapshot__item">
              <span class="case-snapshot__label">Industry</span>
              <span class="case-snapshot__value">{industry}</span>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Overview -->
    <section class="case-overview section">
      <div class="container">
        <div class="case-overview__grid">
          <div class="case-overview__content" data-animate>
            <slot />
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <section class="case-nav section">
      <div class="container">
        <div class="case-nav__grid">
          {prevProject ? (
            <a href={`/work/${prevProject.slug}`} class="case-nav__link case-nav__link--prev">
              <span class="case-nav__label">Previous Project</span>
              <span class="case-nav__title">{prevProject.title}</span>
            </a>
          ) : <div />}
          
          <a href="/work" class="case-nav__back">
            View All Work
          </a>
          
          {nextProject ? (
            <a href={`/work/${nextProject.slug}`} class="case-nav__link case-nav__link--next">
              <span class="case-nav__label">Next Project</span>
              <span class="case-nav__title">{nextProject.title}</span>
            </a>
          ) : <div />}
        </div>
      </div>
    </section>
  </main>
  <Footer />
</BaseLayout>

<style is:global>
  /* Case Study Content Styles */
  .case-overview__content h2 {
    font-size: var(--font-size-2xl);
    margin-top: var(--space-12);
    margin-bottom: var(--space-4);
  }

  .case-overview__content h2:first-child {
    margin-top: 0;
  }

  .case-overview__content h3 {
    font-size: var(--font-size-xl);
    margin-top: var(--space-8);
    margin-bottom: var(--space-3);
  }

  .case-overview__content h4 {
    font-size: var(--font-size-lg);
    margin-top: var(--space-6);
    margin-bottom: var(--space-2);
  }

  .case-overview__content h5 {
    font-size: var(--font-size-base);
    margin-top: var(--space-5);
    margin-bottom: var(--space-2);
  }

  .case-overview__content h6 {
    font-size: var(--font-size-sm);
    margin-top: var(--space-4);
    margin-bottom: var(--space-2);
  }

  .case-overview__content p {
    margin-bottom: var(--space-4);
    line-height: var(--line-height-relaxed);
    font-size: var(--font-size-lg);
  }

  .case-overview__content > :is(h2, h3, h4, p, ul, ol, blockquote) {
    width: min(100%, 70ch);
    margin-inline: auto;
  }

  .case-overview__content .case-callout {
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
    margin-block: var(--space-10);
    padding-block: var(--space-10);
    background: var(--color-surface-elevated);
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  @supports (background: color-mix(in srgb, white, black)) {
    .case-overview__content .case-callout {
      background:
        linear-gradient(
          135deg,
          color-mix(in srgb, var(--color-electric-blue) 10%, transparent) 0%,
          transparent 60%
        ),
        color-mix(in srgb, var(--color-accent) 8%, var(--color-surface-elevated));
      border-top-color: color-mix(in srgb, var(--color-accent) 18%, var(--color-border));
      border-bottom-color: color-mix(in srgb, var(--color-accent) 18%, var(--color-border));
    }

    [data-theme="light"] .case-overview__content .case-callout {
      background:
        linear-gradient(
          135deg,
          color-mix(in srgb, var(--color-electric-blue) 16%, transparent) 0%,
          transparent 60%
        ),
        color-mix(in srgb, var(--color-accent) 18%, var(--color-surface-elevated));
      border-top-color: color-mix(in srgb, var(--color-accent) 32%, var(--color-border));
      border-bottom-color: color-mix(in srgb, var(--color-accent) 32%, var(--color-border));
    }
  }

  .case-overview__content .case-callout__inner {
    width: min(100% - (var(--container-padding) * 2), 70ch);
    margin-inline: auto;
  }

  .case-overview__content .case-callout__title {
    margin: 0 0 var(--space-3);
    font-size: var(--font-size-xl);
  }

  .case-overview__content .case-callout__inner > :last-child {
    margin-bottom: 0;
  }

  .case-overview__content ul,
  .case-overview__content ol {
    margin-bottom: var(--space-4);
    padding-left: var(--space-6);
  }

  .case-overview__content li {
    margin-bottom: var(--space-2);
    color: var(--color-text-secondary);
    font-size: var(--font-size-lg);
  }

  .case-overview__content blockquote {
    margin: var(--space-8) 0;
    padding: var(--space-6);
    background: var(--color-surface);
    border-left: 3px solid var(--color-accent);
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
  }

  .case-overview__content blockquote p {
    font-size: var(--font-size-lg);
    font-style: italic;
    color: var(--color-text-primary);
    margin-bottom: 0;
  }

  .case-overview__content img {
    width: 100%;
    border-radius: var(--radius-lg);
    margin: var(--space-8) 0;
  }

  .case-overview__content figure {
    margin: var(--space-8) 0;
  }

  .case-overview__content figure img {
    margin: 0;
  }

  .case-overview__content figcaption {
    margin-top: var(--space-3);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
  }

  .case-overview__content .case-split {
    width: min(100%, 1100px);
    margin-inline: auto;
    margin-block: var(--space-10);
    display: grid;
    gap: var(--space-8);
  }

  .case-overview__content .case-split__media img {
    width: 100%;
    height: auto;
    margin: 0;
    border-radius: var(--radius-lg);
  }

  .case-overview__content .case-split__content > :first-child {
    margin-top: 0;
  }

  .case-overview__content .case-split__content > :last-child {
    margin-bottom: 0;
  }

  .case-overview__content .image-grid {
    display: grid;
    gap: var(--space-4);
    margin: var(--space-8) 0;
  }

  .case-overview__content .image-grid img {
    margin: 0;
  }

  .case-overview__content .image-grid.image-grid--tight {
    gap: var(--space-3);
  }

  .case-overview__content .image-grid.image-grid--wide {
    gap: var(--space-6);
  }

  .case-overview__content .image-bleed {
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
  }

  .case-overview__content .image-bleed img {
    margin: 0;
    border-radius: 0;
  }

  @media (min-width: 768px) {
    .case-overview__content .image-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .case-overview__content .case-split {
      grid-template-columns: 1.15fr 0.85fr;
      align-items: start;
    }

    .case-overview__content .case-split--reverse {
      grid-template-columns: 0.85fr 1.15fr;
    }

    .case-overview__content .case-split--reverse .case-split__media {
      grid-column: 2;
    }

    .case-overview__content .case-split--reverse .case-split__content {
      grid-column: 1;
    }

    .case-overview__content .image-grid.image-grid--three {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>

<style>
  /* Case Hero */
  .case-hero {
    padding-top: calc(var(--space-32) + var(--space-16));
    padding-bottom: var(--space-12);
  }

  .case-hero__layout {
    display: grid;
    gap: var(--space-8);
    align-items: center;
  }

  .case-hero__media {
    position: relative;
  }

  .case-hero__img {
    display: block;
    width: 100%;
    aspect-ratio: 16 / 10;
    object-fit: cover;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
  }

  /* Case Snapshot */
  .case-snapshot {
    padding-bottom: var(--space-1);
  }

  .case-snapshot__card {
    display: grid;
    gap: var(--space-6);
    padding: var(--space-8);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .case-snapshot__header {
    grid-column: 1 / -1;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .case-snapshot__item {
    min-width: 0;
  }

  .case-snapshot__label {
    display: block;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-1);
  }

  .case-snapshot__value {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-primary);
  }

  .case-hero__category {
    display: inline-block;
    font-size: var(--font-size-sm);
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-4);
  }

  .case-hero__title {
    font-size: clamp(var(--font-size-4xl), 8vw, var(--font-size-6xl));
    margin-bottom: var(--space-6);
  }

  .case-hero__description {
    font-size: var(--font-size-xl);
    line-height: var(--line-height-relaxed);
    max-width: 52ch;
  }

  .case-hero__card {
    width: min(100%, 560px);
    padding: var(--space-10);
    background: rgba(10, 10, 10, 0.78);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(14px) saturate(1.1);
    -webkit-backdrop-filter: blur(14px) saturate(1.1);
  }

  .case-hero__card .case-hero__title {
    color: var(--color-overlay-text);
    font-size: clamp(var(--font-size-3xl), 5vw, var(--font-size-5xl));
    line-height: var(--line-height-tight);
  }

  .case-hero__card .case-hero__description {
    color: rgba(255, 255, 255, 0.78);
  }

  .case-hero__image-placeholder {
    width: 100%;
    aspect-ratio: 16 / 10;
    background: linear-gradient(135deg, var(--color-surface-elevated) 0%, var(--color-surface) 100%);
    border-radius: var(--radius-lg);
  }

  @media (max-width: 899px) {
    .case-hero__card {
      margin-top: var(--space-2);
      position: relative;
      z-index: 2;
    }
  }

  @media (min-width: 900px) {
    .case-hero__layout {
      grid-template-columns: repeat(12, 1fr);
      gap: 0;
    }

    .case-hero__media {
      grid-column: 1 / span 9;
      grid-row: 1;
    }

    .case-hero__card {
      z-index: 2;
      grid-column: 8 / -1;
      grid-row: 1;
      margin-left: 0;
      justify-self: end;
      align-self: center;
    }
  }

  /* Case Overview */
  .case-overview.section {
    padding-top: var(--space-1);
  }

  .case-overview__grid {
    display: grid;
    gap: var(--space-12);
  }

  .case-overview__content :is(h2, h3, h4, p, ul, ol, blockquote) {
    max-width: 70ch;
    margin-inline: auto;
  }

  /* Case Navigation */
  .case-nav {
    border-top: 1px solid var(--color-border);
  }

  .case-nav__grid {
    display: grid;
    gap: var(--space-6);
    align-items: center;
  }

  .case-nav__link {
    padding: var(--space-6);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
    transition: border-color var(--transition-fast);
  }

  .case-nav__link:hover {
    border-color: var(--color-border-light);
  }

  .case-nav__label {
    display: block;
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-2);
  }

  .case-nav__title {
    font-family: var(--font-family-display);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
  }

  .case-nav__link--next {
    text-align: right;
  }

  .case-nav__back {
    font-size: var(--font-size-sm);
    color: var(--color-accent);
    text-align: center;
    font-weight: var(--font-weight-medium);
  }

  .case-nav__back:hover {
    color: var(--color-accent-hover);
  }

  /* Responsive */
  @media (min-width: 768px) {
    .case-overview__grid {
      gap: var(--space-16);
    }

    .case-snapshot__card {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }

    .case-nav__grid {
      grid-template-columns: 1fr auto 1fr;
    }
  }
</style>

<script>
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('[data-animate]').forEach(el => {
    observer.observe(el);
  });
</script>
